<html>

<head>
<title>Markov Chain Example</title>
<script src="http://code.jquery.com/jquery-latest.min.js" type="text/javascript"></script>

<script type="text/javascript">
var titles = [
    "Knowing that Mrs. Mallard was afflicted with a heart trouble, great care was taken to break to her as gently as possible the news of her husband's death.It was her sister Josephine who told her, in broken sentences; veiled hints that revealed in half concealing. Her husband's friend Richards was there, too, near her. It was he who had been in the newspaper office when intelligence of the railroad disaster was received, with Brently Mallard's name leading the list of killed. He had only taken the time to assure himself of its truth by a second telegram, and had hastened to forestall any less careful, less tender friend in bearing the sad message.She did not hear the story as many women have heard the same, with a paralyzed inability to accept its significance. She wept at once, with sudden, wild abandonment, in her sister's arms. When the storm of grief had spent itself she went away to her room alone. She would have no one follow her.There stood, facing the open window, a comfortable, roomy armchair. Into this she sank, pressed down by a physical exhaustion that haunted her body and seemed to reach into her soul.She could see in the open square before her house the tops of trees that were all aquiver with the new spring life. The delicious breath of rain was in the air. In the street below a peddler was crying his wares. The notes of a distant song which someone was singing reached her faintly, and countless sparrows were twittering in the eaves.There were patches of blue sky showing here and there through the clouds that had met and piled one above the other in the west facing her window.She sat with her head thrown back upon the cushion of the chair, quite motionless, except when a sob came up into her throat and shook her, as a child who has cried itself to sleep continues to sob in its dreams.She was young, with a fair, calm face, whose lines bespoke repression and even a certain strength. But now there was a dull stare in her eyes, whose gaze was fixed away off yonder on one of those patches of blue sky. It was not a glance of reflection, but rather indicated a suspension of intelligent thought.There was something coming to her and she was waiting for it, fearfully. What was it? She did not know; it was too subtle and elusive to name. But she felt it, creeping out of the sky, reaching toward her through the sounds, the scents, the color that filled the air.Now her bosom rose and fell tumultuously. She was beginning to recognize this thing that was approaching to possess her, and she was striving to beat it back with her will--as powerless as her two white slender hands would have been. When she abandoned herself a little whispered word escaped her slightly parted lips. She said it over and over under the breath: free, free, free! The vacant stare and the look of terror that had followed it went from her eyes. They stayed keen and bright. Her pulses beat fast, and the coursing blood warmed and relaxed every inch of her body.She did not stop to ask if it were or were not a monstrous joy that held her. A clear and exalted perception enabled her to dismiss the suggestion as trivial. She knew that she would weep again when she saw the kind, tender hands folded in death; the face that had never looked save with love upon her, fixed and gray and dead. But she saw beyond that bitter moment a long procession of years to come that would belong to her absolutely. And she opened and spread her arms out to them in welcome.There would be no one to live for during those coming years; she would live for herself. There would be no powerful will bending hers in that blind persistence with which men and women believe they have a right to impose a private will upon a fellow-creature. A kind intention or a cruel intention made the act seem no less a crime as she looked upon it in that brief moment of illumination.And yet she had loved him--sometimes. Often she had not. What did it matter! What could love, the unsolved mystery, count for in the face of this possession of self-assertion which she suddenly recognized as the strongest impulse of her being!Free! Body and soul free! she kept whispering.Josephine was kneeling before the closed door with her lips to the keyhole, imploring for admission. Louise, open the door! I beg; open the door--you will make yourself ill. What are you doing, Louise? For heaven's sake open the door.Go away. I am not making myself ill. No; she was drinking in a very elixir of life through that open window.Her fancy was running riot along those days ahead of her. Spring days, and summer days, and all sorts of days that would be her own. She breathed a quick prayer that life might be long. It was only yesterday she had thought with a shudder that life might be long.She arose at length and opened the door to her sister's importunities. There was a feverish triumph in her eyes, and she carried herself unwittingly like a goddess of Victory. She clasped her sister's waist, and together they descended the stairs. Richards stood waiting for them at the bottom.Someone was opening the front door with a latchkey. It was Brently Mallard who entered, a little travel-stained, composedly carrying his grip-sack and umbrella. He had been far from the scene of the accident, and did not even know there had been one. He stood amazed at Josephine's piercing cry; at Richards' quick motion to screen him from the view of his wife.When the doctors came they said she had died of heart disease--of the joy that kills.",
	"The most notable thing about Time is that it is so purely relative. A large amount of reminiscence is, by common consent, conceded to the drowning man; and it is not past belief that one may review an entire courtship while removing one's gloves. That is what Trysdale was doing, standing by a table in his bachelor apartments. On the table stood a singular-looking green plant in a red earthen jar. The plant was one of the species of cacti, and was provided with long, tentacular leaves that perpetually swayed with the slightest breeze with a peculiar beckoning motion. Trysdale's friend, the brother of the bride, stood at a sideboard complaining at being allowed to drink alone. Both men were in evening dress. White favors like stars upon their coats shone through the gloom of the apartment.As he slowly unbuttoned his gloves, there passed through Trysdale's mind a swift, scarifying retrospect of the last few hours. It seemed that in his nostrils was still the scent of the flowers that had been banked in odorous masses about the church, and in his ears the lowpitched hum of a thousand well-bred voices, the rustle of crisp garments, and, most insistently recurring, the drawling words of the minister irrevocably binding her to another.From this last hopeless point of view he still strove, as if it had become a habit of his mind, to reach some conjecture as to why and how he had lost her. Shaken rudely by the uncompromising fact, he had suddenly found himself confronted by a thing he had never before faced --his own innermost, unmitigated, arid unbedecked self. He saw all the garbs of pretence and egoism that he had worn now turn to rags of folly. He shuddered at the thought that to others, before now, the garments of his soul must have appeared sorry and threadbare. Vanity and conceit? These were the joints in his armor. And how free from either she had always been--But why--As she had slowly moved up the aisle toward the altar he had felt an unworthy, sullen exultation that had served to support him. He had told himself that her paleness was from thoughts of another than the man to whom she was about to give herself. But even that poor consolation had been wrenched from him. For, when he saw that swift, limpid, upward look that she gave the man when he took her hand, he knew himself to be forgotten. Once that same look had been raised to him, and he had gauged its meaning. Indeed, his conceit had crumbled; its last prop was gone. Why had it ended thus? There had been no quarrel between them, nothing--For the thousandth time he remarshalled in his mind the events of those last few days before the tide had so suddenly turned.She had always insisted upon placing him upon a pedestal, and he had accepted her homage with royal grandeur. It had been a very sweet incense that she had burned before him; so modest (he told himself); so childlike and worshipful, and (he would once have sworn) so sincere. She had invested him with an almost supernatural number of high attributes and excellencies and talents, and he had absorbed the oblation as a desert drinks the rain that can coax from it no promise of blossom or fruit.As Trysdale grimly wrenched apart the seam of his last glove, the crowning instance of his fatuous and tardily mourned egoism came vividly back to him. The scene was the night when he had asked her to come up on his pedestal with him and share his greatness. He could not, now, for the pain of it, allow his mind to dwell upon the memory of her convincing beauty that night--the careless wave of her hair, the tenderness and virginal charm of her looks and words. But they had been enough, and they had brought him to speak. During their conversation she had said:Now, Carruthers was an idiot. No doubt he (Trysdale) had been guilty (he sometimes did such things) of airing at the club some old, canting Castilian proverb dug from the hotchpotch at the back of dictionaries. Carruthers, who was one of his incontinent admirers, was the very man to have magnified this exhibition of doubtful erudition.But, alas! the incense of her admiration had been so sweet and flattering. He allowed the imputation to pass without denial. Without protest, he allowed her to twine about his brow this spurious bay of Spanish scholarship. He let it grace his conquering head, and, among its soft convolutions, he did not feel the prick of the thorn that was to pierce him later.How glad, how shy, how tremulous she was! How she fluttered like a snared bird when he laid his mightiness at her feet! He could have sworn, and he could swear now, that unmistakable consent was in her eyes, but, coyly, she would give him no direct answer. I will send you my answer to-morrow, she said; and he, the indulgent, confident victor, smilingly granted the delay. The next day he waited, impatient, in his rooms for the word. At noon her groom came to the door and left the strange cactus in the red earthen jar. There was no note, no message, merely a tag upon the plant bearing a barbarous foreign or botanical name. He waited until night, but her answer did not come. His large pride and hurt vanity kept him from seeking her. Two evenings later they met at a dinner. Their greetings were conventional, but she looked at him, breathless, wondering, eager. He was courteous, adamant, waiting her explanation. With womanly swiftness she took her cue from his manner, and turned to snow and ice. Thus, and wider from this on, they had drifted apart. Where was his fault? Who had been to blame? Humbled now, he sought the answer amid the ruins of his self-conceit. If--The voice of the other man in the room, querulously intruding upon his thoughts, aroused him. I say, Trysdale, what the deuce is the matter with you? You look unhappy as if you yourself had been married instead of having acted merely as an accomplice. Look at me, another accessory, come two thousand miles on a garlicky, cockroachy banana steamer all the way from South America to connive at the sacrifice--please to observe how lightly my guilt rests upon my shoulders. Only little sister I had, too, and now she's gone. Come now! take something to ease your conscience.I don't drink just now, thanks, said Trysdale.Your brandy, resumed the other, coming over and joining him, is abominable. Run down to see me some time at Punta Redonda, and try some of our stuff that old Garcia smuggles in. It's worth the, trip. Hallo! here's an old acquaintance. Wherever did you rake up this cactus, Trysdale?",
	""
];

var terminals = {};
var startwords = [];
var wordstats = {};

for (var i = 0; i < titles.length; i++) {
    var words = titles[i].split(' ');
    terminals[words[words.length-1]] = true;
    startwords.push(words[0]);
    for (var j = 0; j < words.length - 1; j++) {
        if (wordstats.hasOwnProperty(words[j])) {
            wordstats[words[j]].push(words[j+1]);
        } else {
            wordstats[words[j]] = [words[j+1]];
        }
    }
}

/* Este choice é random, uma forma de optimização é ver qual a palavra que oco */
var choice = function (a) {
    var i = Math.floor(a.length * Math.random());
    return a[i];
};

var make_title = function (min_length) {
    word = choice(startwords);
    var title = [word];
    while (wordstats.hasOwnProperty(word)) {
        var next_words = wordstats[word]; 
        word = choice(next_words);
        title.push(word);
        if (title.length > min_length && terminals.hasOwnProperty(word)) break;
    }
    if (title.length < min_length) return make_title(min_length);
    return title.join(' ');
};


function work(){
	//var title = make_title(3 + Math.floor(3 * Math.random()));
	var title = make_title(200 + Math.floor(50 * Math.random()));
    $('#generated_title').html(title);
}

</script>

</head>

<body>

<div id="generated_title"></div>
<input type="button" id="generate" value="Generate" onclick="work()" />

</body>

</html>